#!/bin/sh
#
# Usage: ./server <my-ip>
#

# Grab ip from args
HOST=$1

VOLNAME=ndslabs
BRKPATH=/var/glfs/$VOLNAME/brick0

DEBUG="echo"

echo Starting GlusterFS server on $HOST

# Start supervisord to keep glusterd running
$DEBUG /usr/bin/supervisord

# Create necessary volume if it doesn't exist
if [ ! -d "$BRKPATH" ]; then
	echo Creating volume: $BRKPATH

	$DEBUG mkdir -p $BRKPATH
	$DEBUG gluster volume create $VOLNAME transport tcp $HOST:$BRKPATH
	$DEBUG gluster volume start $VOLNAME
fi

echo GlusterFS server started
